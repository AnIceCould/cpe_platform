<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®æ—¶ä¸¢åŒ…è­¦æŠ¥</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #121212; color: #e0e0e0; margin: 0; padding: 2rem; }
        .container { max-width: 800px; margin: auto; }
        h1 { color: #bb86fc; border-bottom: 2px solid #333; padding-bottom: 10px; }
        #status { background-color: #333; padding: 10px 15px; border-radius: 8px; margin-bottom: 20px; font-weight: bold; }
        .status-connected { color: #03dac6; }
        .status-disconnected { color: #cf6679; }
        #alerts { display: flex; flex-direction: column-reverse; }
        .alert {
            background-color: #cf6679;
            color: #121212;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.4);
            animation: fadeIn 0.5s ease-in-out;
        }
        .alert-header { font-weight: bold; font-size: 1.1em; margin-bottom: 8px; }
        .alert-body { font-family: 'Courier New', Courier, monospace; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div class="container">
        <h1>å®æ—¶ä¸¢åŒ…è­¦æŠ¥ç›‘æ§</h1>
        <div id="status">è¿æ¥çŠ¶æ€: æ­£åœ¨è¿æ¥...</div>
        <div id="alerts">
            <!-- è­¦æŠ¥å°†åœ¨è¿™é‡ŒåŠ¨æ€æ’å…¥ -->
        </div>
    </div>

    <script>
        const statusDiv = document.getElementById('status');
        const alertsContainer = document.getElementById('alerts');
        const wsUrl = 'ws://localhost:8080/ws/alerts';

        function connect() {
            const socket = new WebSocket(wsUrl);

            socket.onopen = function(event) {
                console.log('WebSocket è¿æ¥å·²å»ºç«‹');
                statusDiv.textContent = 'è¿æ¥çŠ¶æ€: å·²è¿æ¥';
                statusDiv.className = 'status-connected';
            };

            socket.onmessage = function(event) {
                console.log('æ”¶åˆ°æ¶ˆæ¯:', event.data);
                const alertData = JSON.parse(event.data);
                
                const alertElement = document.createElement('div');
                alertElement.className = 'alert';
                
                const header = document.createElement('div');
                header.className = 'alert-header';
                header.textContent = `ğŸš¨ æ£€æµ‹åˆ°ä¸¢åŒ…äº‹ä»¶ï¼`;
                
                const body = document.createElement('div');
                body.className = 'alert-body';
                body.innerHTML = `
                    è®¾å¤‡ID: ${alertData.deviceId}<br>
                    æ—¶é—´æˆ³: ${new Date(alertData.predictionTimestamp).toLocaleString()}
                `;
                
                alertElement.appendChild(header);
                alertElement.appendChild(body);
                
                alertsContainer.prepend(alertElement); // å°†æ–°è­¦æŠ¥æ”¾åœ¨æœ€ä¸Šé¢
            };

            socket.onclose = function(event) {
                console.log('WebSocket è¿æ¥å·²å…³é—­. æ­£åœ¨å°è¯•é‡æ–°è¿æ¥...');
                statusDiv.textContent = 'è¿æ¥çŠ¶æ€: å·²æ–­å¼€ï¼Œæ­£åœ¨é‡è¿...';
                statusDiv.className = 'status-disconnected';
                // 3ç§’åå°è¯•é‡è¿
                setTimeout(connect, 3000);
            };

            socket.onerror = function(error) {
                console.error('WebSocket é”™è¯¯:', error);
            };
        }

        // é¦–æ¬¡è¿æ¥
        connect();
    </script>
</body>
</html>
